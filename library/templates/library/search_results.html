{% extends 'library/base.html' %}

{% block title %}Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¨Ø­Ø« - Ù…ÙƒØªØ¨Ø© Ø¢Ù„ÙŠØ³Ø§Ø±{% endblock %}

{% block content %}
<div class="container py-5" style="padding-top: 150px;">
    
    <!-- ==================== Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø³Ø±ÙŠ ==================== -->
    {% if query %}
        {% if query == "admin123" or query == "library010" or query == "alisar101" %}
            <!-- Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø±Ù…Ø² Ø³Ø±ÙŠ - ØªÙˆØ¬ÙŠÙ‡ Ù…Ø¨Ø§Ø´Ø± Ù„Ù„Ø¥Ø¯Ø§Ø±Ø© -->
            <div class="text-center py-5">
                <div class="alert alert-success">
                    <i class="fas fa-check-circle fa-3x mb-3"></i>
                    <h4>ğŸ” ØªÙ… Ø§Ù„ØªØ­Ù‚Ù‚ Ø¨Ù†Ø¬Ø§Ø­!</h4>
                    <p class="mb-3">Ø¬Ø§Ø±ÙŠ ØªÙˆØ¬ÙŠÙ‡Ùƒ Ø¥Ù„Ù‰ Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©...</p>
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</span>
                    </div>
                </div>
            </div>
            
            <script>
                document.addEventListener('DOMContentLoaded', function() {
                    // ØªÙˆØ¬ÙŠÙ‡ Ø¨Ø¹Ø¯ 2 Ø«Ø§Ù†ÙŠØ©
                    setTimeout(function() {
                        window.location.href = "/admin";
                    }, 2000);
                });
            </script>
            
            <!-- Ø¥Ø®ÙØ§Ø¡ Ø¨Ù‚ÙŠØ© Ø§Ù„ØµÙØ­Ø© -->
            <style>
                .container > .row:first-child,
                .alert-info,
                .row {
                    display: none !important;
                }
            </style>
            
            {% else %}
            <!-- Ø¥Ø°Ø§ ÙƒØ§Ù† Ø¨Ø­Ø« Ø¹Ø§Ø¯ÙŠ - Ø¹Ø±Ø¶ Ø§Ù„ØµÙØ­Ø© ÙƒØ§Ù„Ù…Ø¹ØªØ§Ø¯ -->
        {% endif %}
    {% endif %}
    <!-- ==================== Ù†Ù‡Ø§ÙŠØ© Ø§Ù„ØªØ­Ù‚Ù‚ ==================== -->
    
    <!-- Ø´Ø±ÙŠØ· Ø§Ù„Ø¨Ø­Ø« -->
    <div class="row justify-content-center mb-5">
        <div class="col-md-8">
            <div class="card shadow-sm border-0" style="border-radius: 15px;">
                <div class="card-body p-4">
                    <h3 class="text-center mb-4 text-primary">
                        <i class="fas fa-search me-2"></i>Ø¨Ø­Ø« ÙÙŠ Ù…ÙƒØªØ¨Ø© Ø¢Ù„ÙŠØ³Ø§Ø±
                    </h3>
                    
                    <form method="GET" action="{% url 'search' %}">
                        <div class="input-group">
                            <input type="text" 
                                   name="q" 
                                   class="form-control" 
                                   placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† ÙƒØªØ§Ø¨ØŒ Ù…Ø¤Ù„ÙØŒ Ø£Ùˆ Ù…ÙˆØ¶ÙˆØ¹..." 
                                   value="{{ query }}"
                                   style="text-align: right;">
                            <button class="btn btn-primary" type="submit">
                                <i class="fas fa-search me-2"></i>Ø¨Ø­Ø«
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù†ØªØ§Ø¦Ø¬ -->
    {% if query and query != "admin123" and query != "secret2024" and query != "alisar" %}
    <div class="alert alert-info mb-4">
        <div class="d-flex align-items-center">
            <i class="fas fa-info-circle me-3"></i>
            <div>
                <h5>Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù†: "<span class="text-success">{{ query }}</span>"</h5>
                {% if books %}
                    <p>ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ <strong>{{ books|length }}</strong> Ù†ØªÙŠØ¬Ø©</p>
                {% endif %}
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Ø¹Ø±Ø¶ Ø§Ù„ÙƒØªØ¨ -->
    {% if books %}
        <div class="row">
            {% for book in books %}
            <div class="col-md-4 mb-4">
                <div class="card h-100">
                    <div class="card-body">
                        <!-- Ø§Ù„Ø¹Ù†ÙˆØ§Ù† -->
                        <h5 class="card-title text-primary">{{ book.title }}</h5>
                        
                        <!-- Ø§Ù„Ù…Ø¤Ù„Ù -->
                        <h6 class="card-subtitle mb-3 text-muted">
                            <i class="fas fa-user me-2"></i>
                            {% if book.author %}
                                {{ book.author.name }}
                            {% else %}
                                Ù…Ø¤Ù„Ù ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ
                            {% endif %}
                        </h6>
                        
                        <!-- Ø§Ù„ØªØµÙ†ÙŠÙ -->
                        {% if book.category %}
                        <p class="mb-2">
                            <i class="fas fa-tag me-2"></i>
                            {{ book.category.name }}
                        </p>
                        {% endif %}
                        
                        <!-- Ø§Ù„ÙˆØµÙ -->
                        {% if book.description %}
                        <p class="card-text">
                            {{ book.description|truncatewords:20 }}
                        </p>
                        {% endif %}
                    </div>
                    
                    <div class="card-footer">
                        <div class="d-flex justify-content-between">
                            <!-- Ø²Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„ -->
                            {% if book.pdf_file %}
                            <a href="{{ book.pdf_file.url }}" class="btn btn-success btn-sm" target="_blank">
                                <i class="fas fa-download me-1"></i>ØªØ­Ù…ÙŠÙ„
                            </a>
                            {% else %}
                            <button class="btn btn-secondary btn-sm" disabled>
                                <i class="fas fa-download me-1"></i>ØºÙŠØ± Ù…ØªÙˆÙØ±
                            </button>
                            {% endif %}
                            
                            <!-- Ø²Ø± Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„ÙƒØªØ§Ø¨ -->
                            {% if book.pdf_file %}
                            <a href="{{ book.pdf_file.url }}" 
                            class="btn btn-primary btn-sm" 
                            target="_blank">
                                <i class="fas fa-book-open me-1"></i>Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„ÙƒØªØ§Ø¨
                            </a>
                            {% else %}
                            <button class="btn btn-secondary btn-sm" disabled>
                                <i class="fas fa-book-open me-1"></i>ØºÙŠØ± Ù…ØªÙˆÙØ±
                            </button>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        
    {% else %}
        <!-- Ø¥Ø°Ø§ Ù„Ù… ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ -->
        {% if query and query != "admin123" and query != "secret2024" and query != "alisar" %}
        <div class="text-center py-5">
            <div class="alert alert-warning">
                <i class="fas fa-search fa-2x mb-3"></i>
                <h4>Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù†ØªØ§Ø¦Ø¬</h4>
                <p class="mb-3">Ù„Ù… Ù†ØªÙ…ÙƒÙ† Ù…Ù† Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ÙƒØªØ¨ ØªØ·Ø§Ø¨Ù‚ "{{ query }}"</p>
                
                <div class="mt-3">
                    <h6>Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª Ù„Ù„Ø¨Ø­Ø«:</h6>
                    <div class="d-flex flex-wrap justify-content-center gap-2 mt-2">
                        <button class="btn btn-outline-primary btn-sm" onclick="setSearch('Ø±ÙˆØ§ÙŠØ©')">Ø±ÙˆØ§ÙŠØ©</button>
                        <button class="btn btn-outline-primary btn-sm" onclick="setSearch('Ø¯ÙŠÙ†ÙŠ')">ÙƒØªØ§Ø¨ Ø¯ÙŠÙ†ÙŠ</button>
                        <button class="btn btn-outline-primary btn-sm" onclick="setSearch('ØªØ¹Ù„ÙŠÙ…ÙŠ')">ÙƒØªØ§Ø¨ ØªØ¹Ù„ÙŠÙ…ÙŠ</button>
                        <button class="btn btn-outline-primary btn-sm" onclick="setSearch('ØªØ§Ø±ÙŠØ®')">ÙƒØªØ§Ø¨ ØªØ§Ø±ÙŠØ®ÙŠ</button>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}
        
        {% if not query %}
        <!-- Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø¨Ø­Ø« ÙØ§Ø±ØºØ§Ù‹ -->
        <div class="text-center py-5">
            <div class="alert alert-info">
                <i class="fas fa-search fa-3x mb-3"></i>
                <h4>Ø§Ø¨Ø­Ø« ÙÙŠ Ù…ÙƒØªØ¨Ø© Ø¢Ù„ÙŠØ³Ø§Ø±</h4>
                <p>Ø§ÙƒØªØ¨ ÙƒÙ„Ù…Ø© Ù„Ù„Ø¨Ø­Ø« ÙÙŠ Ù…ÙƒØªØ¨ØªÙ†Ø§</p>
            </div>
        </div>
        {% endif %}
    {% endif %}
</div>

<script>
// Ø¯Ø§Ù„Ø© Ù„Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ Ø§Ù„ÙƒØªØ§Ø¨
function showBookDetails(bookId) {
    alert('ØªÙØ§ØµÙŠÙ„ Ø§Ù„ÙƒØªØ§Ø¨ Ø±Ù‚Ù…: ' + bookId + '\n\nÙ‡Ø°Ù‡ Ø§Ù„Ù…ÙŠØ²Ø© Ù‚ÙŠØ¯ Ø§Ù„ØªØ·ÙˆÙŠØ±...');
}

// Ø¯Ø§Ù„Ø© Ù„ØªØ¹ÙŠÙŠÙ† Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¨Ø­Ø«
function setSearch(word) {
    const searchInput = document.querySelector('input[name="q"]');
    if (searchInput) {
        searchInput.value = word;
        searchInput.form.submit();
    }
}

// Ø¬Ø¹Ù„ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª ØªÙØ§Ø¹Ù„ÙŠØ©
document.addEventListener('DOMContentLoaded', function() {
    const cards = document.querySelectorAll('.card');
    cards.forEach(card => {
        card.addEventListener('mouseenter', function() {
            this.style.transform = 'translateY(-5px)';
            this.style.boxShadow = '0 5px 15px rgba(0,0,0,0.1)';
        });
        
        card.addEventListener('mouseleave', function() {
            this.style.transform = 'translateY(0)';
            this.style.boxShadow = 'none';
        });
    });
});
</script>

<!-- Ø¥Ø¶Ø§ÙØ© Font Awesome Ù„Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>
.card {
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    border-radius: 10px;
}

.card-title {
    min-height: 3rem;
}

.card-text {
    min-height: 4rem;
}
</style>
{% endblock %}